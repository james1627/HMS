@page "/login"
@rendermode InteractiveAuto

@using HMS.Infrastructure.Services
@inject AuthService AuthService
@inject NavigationManager Navigation

<h3>Login</h3>

<div>
    <label>Username:</label>
    <input @bind="username" />
</div>

<div>
    <label>Password:</label>
    <input type="password" @bind="password" />
</div>

<button @onclick="LoginAsync">Login</button>

@if (!string.IsNullOrEmpty(error))
{
    <p style="color:red">@error</p>
}

@code {
    private string username = "";
    private string password = "";
    private string error = "";

    private async Task LoginAsync()
    {
        try
        {
            var token = await AuthService.LoginAsync(username, password);
            if (!string.IsNullOrEmpty(token))
            {
                // Store token in localStorage
                await JS.InvokeVoidAsync("localStorage.setItem", "authToken", token);
                Navigation.NavigateTo("/projects");
            }
            else
            {
                error = "Login failed";
            }
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }
    }

    [Inject]
    private IJSRuntime JS { get; set; } = default!;
}